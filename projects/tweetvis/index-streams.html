<!DOCTYPE html>
<html>
<meta charset="utf-8">
<style>
 
path {
  stroke: #000;
  fill-opacity: .8;
}
 
</style>
<body>
  <div id = "vis"></div>
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="tweet_spark.js"></script>
  <script>
    d3.json("2014-01-01-tweet-summary.json", function(error, data) {
      var tweet_spark_data = [ [],[],[],[],[],[],[],[],[] ];
      var timeseries_labels = ['count', 'retweets', 'en', 'es', 'ja', 'ar', 'it', 'fr', 'ru'];

      for (var key in data) {
        if (data.hasOwnProperty(key)) {
          /*
          if (tweet_spark_data == null) {
            tweet_spark_data = [];
            tweet_spark_data.push([]);
            //var numLang = 0;
            //for (var langKey in data[key].languages) {
            //  if (data[key].languages.hasOwnProperty(langKey)) {
            //    tweet_spark_data.push([]);  
            //    numLang++;
            //    console.log(langKey);
            //  }
            //}
          }
          */
          tweet_spark_data[0].push(data[key].count);
          tweet_spark_data[1].push(data[key].retweets_count);

          for (var langKey in data[key].languages) {
            if (data[key].languages.hasOwnProperty(langKey)) {
              var lang_index = timeseries_labels.indexOf(langKey);
              /* code to add new label and new array
              if (lang_index == -1) {
                lang_index = timeseries_labels.length;
                timeseries_labels.push(langKey);
                tweet_spark_data.push([]);
              }
              */
              if (lang_index != -1) {
                tweet_spark_data[lang_index].push(data[key].languages[langKey]);  
              }
            }
          }
          //tweet_spark_data[0].push(data[key].count);
          //var i = 0;
          //for (var langKey in data[key].languages) {
          //  tweet_spark_data[i].push(data[key].languages[langKey]);
          //  i += 1;
          //}
        }

               
      }

      //console.log(tweet_spark_data.length + " numLang="+numLang);
      
      console.log(tweet_spark_data[0].length);
      console.log(timeseries_labels[0] + " -> " + tweet_spark_data[0]);
      console.log(timeseries_labels[1] + " -> " + tweet_spark_data[1])
      console.log(timeseries_labels);

      create_tweet_spark(timeseries_labels, tweet_spark_data, "#vis");
    });
  </script>

</body>
</html>